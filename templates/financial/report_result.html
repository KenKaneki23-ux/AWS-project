{% extends "base.html" %}

{% block title %}Report Results - {{ app_name }}{% endblock %}

{% block page_title %}Report Results{% endblock %}
{% block page_description %}Generated financial report based on your filters{% endblock %}

{% block content %}
<!-- Applied Filters -->
<div class="card mb-2">
    <div class="card-header">
        üîç Applied Filters
    </div>
    <div class="card-body">
        <div class="kpi-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
            {% if filters.start_date %}
            <div>
                <div class="kpi-label">Start Date</div>
                <div class="kpi-value" style="font-size: 1rem;">{{ filters.start_date }}</div>
            </div>
            {% endif %}
            {% if filters.end_date %}
            <div>
                <div class="kpi-label">End Date</div>
                <div class="kpi-value" style="font-size: 1rem;">{{ filters.end_date }}</div>
            </div>
            {% endif %}
            {% if filters.transaction_type %}
            <div>
                <div class="kpi-label">Transaction Type</div>
                <div class="kpi-value" style="font-size: 1rem;">{{ filters.transaction_type.title() }}</div>
            </div>
            {% endif %}
            {% if filters.min_amount %}
            <div>
                <div class="kpi-label">Min Amount</div>
                <div class="kpi-value" style="font-size: 1rem;">${{ "{:,.2f}".format(filters.min_amount) }}</div>
            </div>
            {% endif %}
            {% if filters.max_amount %}
            <div>
                <div class="kpi-label">Max Amount</div>
                <div class="kpi-value" style="font-size: 1rem;">${{ "{:,.2f}".format(filters.max_amount) }}</div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Report Summary KPIs -->
<div class="kpi-grid mb-2">
    <div class="kpi-card">
        <div class="kpi-label">Total Transactions</div>
        <div class="kpi-value">{{ report.transaction_count }}</div>
        <div class="kpi-change">Matching filters</div>
    </div>
    <div class="kpi-card success">
        <div class="kpi-label">Total Amount</div>
        <div class="kpi-value">${{ "{:,.2f}".format(report.total_amount) }}</div>
        <div class="kpi-change positive">Volume</div>
    </div>
    {% if report.transaction_count > 0 %}
    <div class="kpi-card">
        <div class="kpi-label">Average Amount</div>
        <div class="kpi-value">${{ "{:,.2f}".format(report.total_amount / report.transaction_count) }}</div>
        <div class="kpi-change">Per transaction</div>
    </div>
    {% endif %}
</div>

<!-- Transaction Details -->
<div class="card">
    <div class="card-header">
        <div class="card-title">üìä Transaction Details</div>
        <div class="card-actions">
            <span class="badge badge-primary">{{ report.transaction_count }} transactions</span>
        </div>
    </div>
    <div class="card-body">
        {% if report.transactions %}
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>Transaction ID</th>
                        <th>Account ID</th>
                        <th>Type</th>
                        <th>Amount</th>
                        <th>Timestamp</th>
                    </tr>
                </thead>
                <tbody>
                    {% for txn in report.transactions %}
                    <tr>
                        <td>{{ txn.transaction_id[:12] }}...</td>
                        <td>{{ txn.account_id[:12] }}...</td>
                        <td>
                            <span
                                class="badge badge-{% if txn.type == 'deposit' %}success{% elif txn.type == 'withdrawal' %}warning{% else %}primary{% endif %}">
                                {{ txn.type.title() }}
                            </span>
                        </td>
                        <td class="text-primary"><strong>${{ "{:,.2f}".format(txn.amount) }}</strong></td>
                        <td>{{ txn.timestamp }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% if report.transaction_count > 100 %}
        <div class="alert alert-info" style="margin-top: var(--spacing-md);">
            ‚ÑπÔ∏è Showing first 100 transactions. Total matching: {{ report.transaction_count }}
        </div>
        {% endif %}
        {% else %}
        <div class="chart-no-data">
            <div class="chart-no-data-icon">üîç</div>
            <div class="chart-no-data-text">No transactions found matching your filters</div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Action Buttons -->
<div style="display: flex; gap: var(--spacing-md); justify-content: center; margin-top: var(--spacing-lg);">
    <a href="{{ url_for('financial.reports') }}" class="btn btn-secondary">
        ‚Üê Back to Report Builder
    </a>
    <a href="{{ url_for('financial.export') }}" class="btn btn-success">
        üì• Export Report
    </a>
</div>

{% endblock %}