{% extends "base.html" %}

{% block title %}Compliance Dashboard - {{ app_name }}{% endblock %}

{% block page_title %}Compliance Monitoring{% endblock %}

{% block content %}
<!-- Compliance Score -->
<div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
    <div class="card-header" style="border-color: rgba(255, 255, 255, 0.2); color: white;">
        âœ… Compliance Score
    </div>
    <div class="card-body">
        <div class="text-center">
            <div style="font-size: 4rem; font-weight: 700;">{{ stats.compliance_score }}</div>
            <div style="font-size: 1.25rem;">out of 100</div>
        </div>
    </div>
</div>

<!-- Regulatory Metrics -->
<div class="kpi-grid">
    <div class="kpi-card">
        <div class="kpi-label">Large Transactions</div>
        <div class="kpi-value">{{ stats.metrics.large_transactions }}</div>
        <div class="kpi-change">&gt; $10,000</div>
    </div>

    <div class="kpi-card warning">
        <div class="kpi-label">Suspicious Activity</div>
        <div class="kpi-value">{{ stats.metrics.suspicious_activities }}</div>
        <div class="kpi-change">Flagged</div>
    </div>

    <div class="kpi-card success">
        <div class="kpi-label">Verification Rate</div>
        <div class="kpi-value">{{ "{:.1f}".format(stats.metrics.verification_rate) }}%</div>
        <div class="kpi-change">{{ stats.metrics.verified_accounts }}/{{ stats.metrics.total_accounts }}</div>
    </div>

    <div class="kpi-card">
        <div class="kpi-label">Frozen Accounts</div>
        <div class="kpi-value">{{ stats.metrics.frozen_accounts }}</div>
        <div class="kpi-change">Risk mitigation</div>
    </div>
</div>

<!-- Threshold Alerts -->
<div class="card">
    <div class="card-header">
        ğŸš¨ Threshold Alerts
    </div>
    <div class="card-body">
        {% if stats.alerts %}
        {% for alert in stats.alerts %}
        <div class="alert-box {{ alert.severity }}">
            <div class="alert-header">
                <div class="alert-title">{{ alert.category }}</div>
                <span class="alert-priority badge badge-{{ alert.severity }}">
                    {{ alert.severity }}
                </span>
            </div>
            <p>{{ alert.message }}</p>
            <div
                style="display: flex; justify-content: space-between; align-items: center; margin-top: var(--spacing-sm);">
                <span class="text-muted">Value: {{ "{:.1f}".format(alert.value) }} | Threshold: {{ alert.threshold
                    }}</span>
                <a href="{{ url_for('compliance.drill_down', metric=alert.category) }}" class="btn btn-sm btn-primary">
                    Investigate
                </a>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="alert-box" style="border-left-color: var(--success-green); background-color: #f0fdf4;">
            <div class="alert-title" style="color: var(--success-green);">âœ“ All Systems Normal</div>
            <p>No threshold alerts at this time. All compliance metrics are within acceptable ranges.</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Quick Actions -->
<div class="card">
    <div class="card-header">
        ğŸ” Quick Actions
    </div>
    <div class="card-body">
        <div class="d-grid"
            style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-md);">
            <a href="{{ url_for('compliance.audit') }}" class="btn btn-outline">
                ğŸ“œ View Audit Log
            </a>
            <a href="{{ url_for('compliance.transactions') }}" class="btn btn-outline">
                ğŸ” Transaction Monitoring
            </a>
            <a href="{{ url_for('compliance.drill_down') }}" class="btn btn-outline">
                ğŸ“Š Root Cause Analysis
            </a>
        </div>
    </div>
</div>
{% endblock %}